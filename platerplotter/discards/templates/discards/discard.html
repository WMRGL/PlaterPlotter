{% extends 'platerplotter/base.html' %}


{% block content %}
    {% if discard_racks %}
        <div class="container">
            <form action="." method="post">
                {% csrf_token %}
                <table class="table table-bordered" id="dataTable">
                    <thead>
                    <tr>
                        <th>Holding rack ID</th>
                        <th>Date of dispatch</th>
                        <th>Status</th>
                        <th>Discarded by</th>
                        <th>Checked by</th>
                        <th>Discard</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for discard_rack in discard_racks %}
                        <tr>
                            <td>
                                <div class="form-group">
                                    <input type="text" class="form-control" value="{{ discard_rack.holding_rack_id }}"
                                           name="holding_rack_id" id="checkedBy" readonly>
                                </div>
                            </td>
                            <td>{{ discard_rack.plate.gel_1008_csv.date_of_dispatch }}</td>
                            <td>OK TO DISCARD</td>
                            <td>{{ user }}</td>
                            <td>
                                <div class="form-group">
                                    <input type="text" class="form-control" name="checked_by" >
                                </div>
                            </td>
                            <td>
                                <div class="form-group">
                                    <input type="checkbox" class="form-control" name="discarded" >
                                </div>
                            </td>

                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    {% endif %}


{#    <div class="container">#}
{#      <form action="." method="post"> {% csrf_token %}#}
{#        <div class="form-group">#}
{#          <label for="holdingRackID">Holding Rack ID</label>#}
{#          <input type="text" class="form-control" id="holdingRackID" name="holding_rack_id">#}
{#        </div>#}
{##}
{#        <div class="form-group">#}
{#          <label for="dateOfDispatch">Date of dispatch</label>#}
{#          <input type="date" class="form-control" id="dateOfDispatch" name="dispatch_date">#}
{#        </div>#}
{##}
{#        <div class="form-group">#}
{#        <label for="discardedBy">Discarded by</label>#}
{#          <span id="discardedBy" class="form-control" >{{discard_form.discarded_by}}</span>#}
{#      </div>#}
{##}
{#        <div class="form-group">#}
{#          <label for="checkedBy">Checked By</label>#}
{#          <input type="text" class="form-control" name="checked_by" id="checkedBy">#}
{#        </div>#}
{##}
{#        <div class="form-group">#}
{#          <label for="discardStatus">Status</label>#}
{#          <input type="text" class="form-control" id="discardStatus" readonly>#}
{#        </div>#}
{##}
{#        <button type="submit" id="discardBtn" class="btn btn-primary" disabled>Submit</button>#}
{#      </form>#}
{#    </div>#}

<script>
  let dispatchDateInput = document.getElementById('dateOfDispatch');
  let todayDate = new Date();
  const discardStatusText = document.getElementById('discardStatus');
  const discardBtn = document.getElementById('discardBtn');

  dispatchDateInput.addEventListener("change", updateValue);

  function updateValue(e) {
    dispatchDate = new Date(e.target.value);
    const timeDifference = Math.abs(todayDate - dispatchDate);
    const weeks = Math.ceil(timeDifference / (1000 * 60 * 60 * 24 * 7));

    if (weeks > 10 ) {
      discardStatusText.value = 'OK TO DISCARD';
      discardStatusText.style.backgroundColor = '#8bf38bbf';
      discardBtn.disabled = false;
    } else {
      discardStatusText.value = 'DO NOT DISCARD';
      discardStatusText.style.backgroundColor = '#ff000047';
    }
  }

</script>

{% endblock %}